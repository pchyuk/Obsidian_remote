# 9. Pipe mode
- GNU Parallel은 명령어 템플릿에 값을 넣는 대신, 표준 입력(stdin)을 명령어로 파이프를 통해 전달할 수 있다.  
- `--pipe` 기능은 GNU Parallel을 다른 모드로 전환한다. 즉, 표준 입력 데이터를 명령어 실행을 위한 인수로 처리하는 대신, 데이터를 명령어의 표준 입력(stdin)으로 전달한다.

- 일반적인 상황은 다음과 같다.
```bash
command_A | command_B | command_C
```

- 여기서 `command_B`가 느릴 경우, 이를 병렬로 실행하여 속도를 높이고자 한다.  
	- 3장에서 제공된 테스트 파일이 필요

## 9.1 Block size
- 기본적으로 GNU Parallel은 `command_B`의 인스턴스를 시작하고, 1MB의 블록을 읽은 다음, 가장 가까운 레코드를 찾아 해당 청크(chunk)를 해당 인스턴스에 전달한다. 
- 그런 다음 다른 인스턴스를 시작하고, 또 다른 블록을 읽어 가장 가까운 레코드를 찾아 두 번째 인스턴스에 해당 청크를 전달한다.

- 예제
```bash
cat numi000000 | parallel --pipe wc
```

- 출력(순서는 다를 수 있음)
```bash
165668 165668 1048571   
149797 149797 1048579   
149796 149796 1048572   
149797 149797 1048579   
149797 149797 1048579   
149796 149796 1048572   
85349 85349 597444
```

- 블록의 크기가 정확히 1MB가 아닌 이유는 GNU Parallel이 절대 줄의 일부만 전달하지 않고 항상 전체 줄을 전달하기 때문이다. 
- 따라서 블록 크기는 평균적으로 1MB 이다. 

- `--block` 옵션을 사용하여 블록 크기를 2MB로 변경할 수 있다.
```bash
cat num1000000 | parallel --pipe --block 2M wc
```

- 출력(순서는 다를 수 있음):
```bash
315465 315465 2097150   
299593 299593 2097151   
299593 299593 2097151   
 85349  85349  597444
```

- GNU Parallel은 각 줄을 하나의 레코드로 처리한다. 
- 레코드의 순서가 중요하지 않은 경우(예: 모든 줄을 처리해야 하지만 어떤 줄이 먼저 처리되는지는 중요하지 않은 경우) `--round-robin` 옵션을 사용할 수 있다. 
- `--round-robin` 옵션이 없을 경우, GNU Parallel은 블록당 하나의 명령을 실행한다. 
	- 하지만 `--round-robin`을 사용하면 요청된 작업 수(-j 또는 --jobs)에 따라 실행된다. 

- 레코드는 실행 중인 작업 사이에 분배된다.
```bash
cat numi0e@0000 | parallel --pipe -j4 --round-robin wc
```

- 출력 예:
```bash
149797 149797 1048579   
299593 299593 2097151   
315465 315465 2097150   
235145 235145 1646016
```

- 4개의 인스턴스 중 1개는 단일 청크를, 2개는 각각 2개의 전체 청크를, 1개는 1개의 전체 청크와 1개의 일부 청크를 받았다.  
`--round-robin`은 준비가 된 첫 번째 프로세스에 청크를 전달합니다. 청크의 순서를 각 프로세스에 엄격히 지정하려면 `--keep-order` 옵션을 사용하세요:

bash

Copy code

`cat numi0@0000 | parallel --pipe -j4 --keep-order --round-robin wc`

출력:

Copy code

`315464 315464 2097143   299592 299592 2097144   235148 235148 1646037   149796 149796 1048572`  

4o