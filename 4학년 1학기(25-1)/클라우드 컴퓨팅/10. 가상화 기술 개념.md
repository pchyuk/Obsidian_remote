## 1. 핵심 개념 복습

### 가상화의 정의 및 중요성

- **가상화란 무엇인가?** 컴퓨터 리소스의 추상화를 일컫는 광범위한 용어이며, 물리적 리소스의 특징을 다른 시스템, 애플리케이션, 최종 사용자로부터 감추는 기술입니다.
- **가상화의 핵심 목적:** 실제 존재하지 않는 하드웨어 플랫폼, 운영체제, 스토리지, 네트워크 등을 가상적으로 제공하여 리소스 활용 효율을 높이고, 유연성을 확보하는 것입니다.
- **가상 시스템과 호스트 시스템의 관계:** 가상 시스템의 동작(𝑆𝑖 → 𝑆𝑗)은 호스트 시스템의 동작(𝑆′𝑖 → 𝑆′𝑗)으로 매핑시키는 함수 𝑉로 설명 가능합니다.

### 가상화 대상 시스템 (매핑 함수 V의 구현 방식)

- **ABI 레벨 가상화:** 소프트웨어 애플리케이션 관점에서 시스템을 가상화하며, 프로세스 가상머신(Process Virtual Machine)으로 구현됩니다. (예: JVM)
- **ISA 레벨 가상화:** 명령어 집합(Instruction Set)에 대한 가상화이며, 시스템 가상머신(System Virtual Machine) 또는 가상머신 모니터(Virtual Machine Monitor)로 구현됩니다. (예: 하이퍼바이저)

### 프로세스 가상머신 세부 유형

- **Multiprogramed System:** 단일 프로세스가 전체 시스템을 독점하는 것처럼 보이게 합니다.
- **Emulator:** User ISA만 에뮬레이션하며, 인터프리터 방식(느리지만 오버헤드 없음)과 바이너리 트랜슬레이터 방식(빠르지만 오버헤드 있음)이 있습니다.
- **Same ISA Binary Optimizer:** 동일한 ISA를 갖는 경우 최적화하여 사용합니다.
- **High Level Language Virtual Machine:** 하드웨어와 운영체제와의 의존 관계를 최소화하는 데 중점을 둡니다. (예: JVM)

### 하이퍼바이저의 이해

- **하이퍼바이저(Hypervisor) = 가상화 소프트웨어 = 가상머신 모니터(VMM):** 가상 머신을 생성하고 관리하는 소프트웨어입니다.
- **호스트 머신(Host Machine):** 하이퍼바이저가 설치되는 물리 시스템입니다.
- **게스트 머신(Guest Machine):** 하이퍼바이저가 관리하는 가상 머신입니다.
- **하이퍼바이저 타입:** 물리 시스템에 직접 설치되는지 여부에 따라 타입 1과 타입 2로 나뉩니다.
- **타입 1 하이퍼바이저 (베어 메탈):** 물리 시스템 하드웨어에 직접 설치되어 OS 역할을 수행합니다. (예: KVM, Xen) 대규모 클라우드 서비스에 적합하며 빠른 통신이 가능합니다. 하드웨어적 가상화 지원(VT-x, AMD-V)을 활용합니다.
- **타입 2 하이퍼바이저:** 호스트 OS 위에서 애플리케이션처럼 설치됩니다. 편리하지만 하드웨어 직접 접근이 어려워 타입 1 대비 오버헤드가 발생합니다. (예: VirtualBox, VMware Workstation) KVM의 경우 타입 1과 타입 2의 경계에 있는 특성을 보입니다.
- **하이퍼바이저 라이프사이클 (인텔 VT-x 기준):VMM 라이프 사이클:** VMXON (VMX 명령 실행 단계 진입) -> VM Entries (루트 모드 -> 비루트 모드, 가상머신 실행) -> VM Exit (비루트 모드 -> 루트 모드, VMM 제어권 획득) -> VM Entries (종료된 VM 재실행) -> VMXOFF (VMM 종료)
- **VMCS (Virtual Machine Control Structure):** 여러 가상머신의 상태를 저장하며, 컨텍스트 스위칭 시 정보가 저장됩니다. Guest State Area, Host State Area, VM Execution Control Fields, VM Exit Control Fields, VM Entry Control Fields, VM Exit Information Fields로 구성됩니다.

### 가상화의 장단점 (클라우드 서비스 관점)

- **장점:** 비용 절감 (적은 하드웨어 구매), 쉬운 백업 및 재해 복구, 중단 없는 비즈니스, 효율적인 IT 운영.
- **단점:** 초기 투자 비용 (소프트웨어 및 하드웨어), 소프트웨어 라이선스 비용, 초기 교육 필요.

### 가상화 타입 (게스트 OS 수정 여부 및 구현 방식)

- **전가상화 (Full Virtualization):** 게스트 OS 수정 없이 가상 머신에 탑재됩니다. 게스트 OS는 가상화 환경을 인지하지 못합니다.
- 하드웨어 관련 명령을 직접 요청하며, 하이퍼바이저가 처리합니다. (오버헤드 발생 가능)
- **소프트웨어 기반 전가상화 (바이너리 트랜슬레이션):** VMWare가 개발한 방식입니다.
- 게스트 OS가 Ring 1에서 동작하며 하이퍼바이저는 Ring 0에 위치합니다.
- 가상화 불가능한 명령(nonvirtualizable instruction)은 하이퍼바이저가 새로운 명령 셋으로 바이너리 트랜슬레이션하여 하드웨어에 전달합니다.
- 특권 명령 수행 시 트랩 발생 -> 하이퍼바이저로 제어 전환.
- **트랩 (Trap):** 사용자 프로그램에서 발생하며 시스템 콜과 같은 특권 명령 실행 시 커널 모드로 전환됩니다.
- **인터럽트 (Interrupt):** 하드웨어에서 비동기적으로 발생합니다.
- **익셉션 (Exception):** CPU에서 발생하며 폴트(복구 가능)와 어보트(복구 불가능)로 구분됩니다.
- 오버헤드가 발생하고 구현이 까다롭습니다.
- **하드웨어 기반 전가상화 (VT-x, AMD-V):** CPU 벤더가 가상화 기능을 하드웨어에 탑재하여 바이너리 트랜슬레이션 없이 가상화 기술을 통해 하드웨어를 직접 제어합니다.
- 게스트 OS는 Ring 0에서 동작하는 비루트 모드에서, 하이퍼바이저는 Ring 0보다 높은 권한의 루트 모드에서 실행됩니다.
- 민감한 요청 시 하이퍼바이저로 트랩이 발생합니다.
- **반가상화 (Paravirtualization):** Xen에서 고안된 방식으로, 게스트 OS가 자신이 가상화 환경에서 실행되고 있음을 인지합니다.
- 게스트 OS를 수정하여 하이퍼바이저와 통신하는 API (하이퍼콜)를 추가합니다.
- 운영체제 소스코드 공개가 필수적이어서 리눅스에 주로 사용됩니다.
- **장점:** 소프트웨어 기반 전가상화보다 성능이 좋으며, 타이머 관리와 같은 특정 시나리오에서 효율적입니다.
- **단점:** 가상 CPU 핸들링의 어려움, 물리 CPU와 다른 동작 방식으로 인해 커널 개발의 비효율성.
- **하이브리드 가상화 (Hybrid Virtualization):** 하드웨어 기반 가상화를 기본으로 사용하되, I/O나 메모리 집약형 작업에서 성능 제약이 있는 경우 반가상화 드라이버를 조합하여 성능을 개선하는 방식입니다.
- (예: VMware ESXi)
- **운영체제 레벨 가상화 (OS Level Virtualization) / 컨테이너화 (Containerization):** 하이퍼바이저 방식과 달리 운영체제를 공유합니다. 컨테이너 엔진을 설치하고 컨테이너를 가상머신처럼 관리합니다.
- 운영체제 공유로 인해 서로 다른 운영체제를 사용하는 컨테이너는 함께 사용할 수 없습니다.
- 리눅스 시스템의 리소스 분리 기술에 기반을 둡니다. (예: Docker)

## 2. 퀴즈

**지시사항:** 다음 각 질문에 대해 2~3문장으로 간결하게 답하시오.

1. 가상화의 핵심 개념은 무엇이며, 이것이 물리적 리소스와 어떻게 다른 방식으로 상호작용하게 하는가?
2. ABI 레벨 가상화와 ISA 레벨 가상화의 주요 차이점은 무엇이며, 각각의 대표적인 예시는 무엇인가?
3. 프로세스 가상머신 중 'Emulator' 방식의 두 가지 세부 구현 방식(인터프리터, 바이너리 트랜슬레이터)의 장단점을 간략히 설명하시오.
4. 타입 1 하이퍼바이저와 타입 2 하이퍼바이저의 가장 큰 설치상의 차이점은 무엇이며, 클라우드 서비스에서 주로 어떤 타입이 사용되는가?
5. 인텔 VT-x 기술을 기반으로 한 하이퍼바이저 라이프사이클에서 'VM Entries'와 'VM Exit'는 각각 어떤 모드 간의 전환을 의미하는가?
6. 클라우드 서비스에서 가상화를 도입할 때 얻을 수 있는 주요 장점 두 가지와 단점 두 가지를 제시하시오.
7. 전가상화에서 '바이너리 트랜슬레이션'이 필요한 이유는 무엇이며, 이 방식의 단점은 무엇인가?
8. 트랩, 인터럽트, 익셉션은 모두 CPU의 제어 흐름을 변경하는 이벤트이다. 이 세 가지의 주요 발생 원인 차이를 설명하시오.
9. 반가상화가 소프트웨어 기반 전가상화의 단점을 보완하는 방식은 무엇이며, 이 방식의 필수 전제 조건은 무엇인가?
10. 운영체제 레벨 가상화(컨테이너화)가 하이퍼바이저 기반 가상화와 구별되는 가장 큰 특징은 무엇인가?

## 3. 퀴즈 정답

1. 가상화의 핵심 개념은 실제 존재하지 않는 하드웨어 플랫폼, 운영체제, 스토리지, 네트워크 등을 가상적으로 제공하는 것입니다. 이는 물리적 리소스의 특징을 다른 시스템, 응용 프로그램, 최종 사용자들이 리소스와 상호작용하는 방식으로부터 감추는 기술을 통해 이루어집니다.
2. ABI 레벨 가상화는 소프트웨어 애플리케이션 관점에서 시스템을 가상화하며 대표적인 예시로 JVM(Java Virtual Machine)이 있습니다. 반면, ISA 레벨 가상화는 명령어 집합에 대한 가상화로 시스템 가상머신(하이퍼바이저)이 이에 해당합니다.
3. 'Emulator' 방식에서 인터프리터는 인스트럭션을 하나씩 해석하여 수행하므로 스타트업 오버헤드가 없지만 느립니다. 바이너리 트랜슬레이터는 소스 인스트럭션을 블럭 단위로 변환하여 수행하므로 스타트업 오버헤드가 존재하지만 빠릅니다.
4. 타입 1 하이퍼바이저는 물리 시스템 하드웨어에 직접 설치되는 반면, 타입 2 하이퍼바이저는 호스트 머신의 운영체제 위에서 애플리케이션처럼 설치됩니다. 대규모 클라우드 컴퓨팅 서비스에서는 확장성과 성능 보장을 위해 타입 1 하이퍼바이저가 주로 도입됩니다.
5. VM Entries는 VMM의 루트 모드에서 가상머신의 비루트 모드로 전환되어 가상머신이 실행되는 것을 의미합니다. 반대로 VM Exit은 가상머신의 비루트 모드에서 VMM의 루트 모드로 제어권이 전환되는 것을 말합니다.
6. 클라우드 서비스에서 가상화의 주요 장점은 적은 컴퓨팅 리소스 구매로 인한 비용 절감과 쉬운 백업 및 재해 복구입니다. 단점으로는 초기 투자 비용(가상화 소프트웨어 및 하드웨어 구매) 발생과 소프트웨어 라이선스 비용 발생이 있습니다.
7. 전가상화에서 '바이너리 트랜슬레이션'은 게스트 OS가 하드웨어 관련 특권 명령을 직접 요청할 때, 하이퍼바이저가 이를 CPU가 인식할 수 있는 새로운 명령으로 변환하기 위해 필요합니다. 이 방식은 중간 처리 과정으로 인해 오버헤드가 발생하고 구현이 까다롭다는 단점이 있습니다.
8. 트랩은 사용자 프로그램에서 시스템 콜과 같은 특권 명령 호출 시 발생하여 커널 모드로 전환됩니다. 인터럽트는 USB 연결이나 네트워크 패킷 수신 등 하드웨어에서 비동기적으로 발생합니다. 익셉션은 CPU에서 0으로 나누기와 같은 오류 발생 시 발생하며, 폴트와 어보트로 구분됩니다.
9. 반가상화는 게스트 OS를 수정하여 하이퍼바이저와 직접 통신할 수 있는 API(하이퍼콜)를 추가함으로써 소프트웨어 기반 전가상화의 오버헤드를 줄입니다. 이 방식의 필수 전제 조건은 게스트 OS의 소스 코드가 공개되어 수정이 가능해야 한다는 점입니다.
10. 운영체제 레벨 가상화(컨테이너화)가 하이퍼바이저 기반 가상화와 구별되는 가장 큰 특징은 운영체제를 공유한다는 점입니다. 하이퍼바이저의 가상머신은 각각 독립적인 운영체제를 갖는 반면, 컨테이너는 호스트 운영체제 커널을 공유하여 실행됩니다.

## 4. 에세이 형식 질문

1. 가상화의 다양한 유형(전가상화, 반가상화, 하이브리드 가상화, OS 레벨 가상화)을 각각 정의하고, 클라우드 환경에서 각 유형이 제공하는 장점과 단점을 비교 분석하시오.
2. 하이퍼바이저의 두 가지 주요 타입(타입 1과 타입 2)을 비교하고, 각 타입이 어떤 사용 환경에 더 적합한지 구체적인 사례를 들어 설명하시오. 또한, KVM이 이 두 타입의 경계선에 있는 이유에 대해 논하시오.
3. 인텔 VT-x와 같은 하드웨어 지원 가상화 기술이 등장하면서 전가상화의 성능이 어떻게 개선되었는지 설명하고, 이 기술이 없는 소프트웨어 기반 전가상화(바이너리 트랜슬레이션)와 비교하여 동작 방식과 효율성 측면에서 어떤 차이가 있는지 분석하시오.
4. 가상화 환경에서 타이머 인터럽트와 같은 특정 하드웨어 자원 접근 시 발생하는 문제점을 전가상화와 반가상화가 각각 어떻게 해결하는지 설명하시오. 이를 통해 반가상화의 '성능상의 이점'과 '단점'이 무엇인지 구체적으로 서술하시오.
5. 프로세스 가상머신과 시스템 가상머신(하이퍼바이저)의 근본적인 차이점을 설명하고, 각 유형이 해결하고자 하는 문제 영역과 대표적인 응용 사례를 제시하시오.

## 5. 용어집 (Glossary)

- **가상화 (Virtualization):** 컴퓨터에서 컴퓨터 리소스의 추상화를 일컫는 광범위한 용어. 물리적인 리소스의 특징을 다른 시스템, 응용 프로그램, 최종 사용자들이 리소스와 상호작용하는 방식으로부터 감추는 기술.
- **ABI (Application Binary Interface):** 소프트웨어 애플리케이션 관점에서 시스템을 가상화하는 방식.
- **ISA (Instruction Set Architecture):** 명령어 집합에 대한 가상화를 의미하는 방식.
- **프로세스 가상머신 (Process Virtual Machine):** ABI 레벨 가상화의 한 형태로, 특정 소프트웨어 애플리케이션이 하위 시스템과 독립적으로 실행될 수 있도록 가상 환경을 제공하는 것. (예: JVM)
- **시스템 가상머신 (System Virtual Machine):** ISA 레벨 가상화의 한 형태로, 전체 하드웨어 플랫폼을 가상화하여 여러 운영체제를 동시에 실행할 수 있게 하는 것.
- **하이퍼바이저 (Hypervisor):** 가상머신 모니터(Virtual Machine Monitor, VMM)라고도 불리며, 여러 개의 가상 머신을 생성하고 관리하는 소프트웨어.
- **호스트 머신 (Host Machine):** 하이퍼바이저가 설치되는 실제 물리 시스템.
- **게스트 머신 (Guest Machine):** 하이퍼바이저가 관리하는 가상 환경 내의 운영체제와 애플리케이션.
- **타입 1 하이퍼바이저 (Bare Metal Hypervisor):** 물리 시스템 하드웨어에 직접 설치되어 운영체제처럼 동작하며 가상 머신을 관리하는 하이퍼바이저. (예: KVM, Xen)
- **타입 2 하이퍼바이저:** 호스트 운영체제 위에 애플리케이션처럼 설치되어 동작하는 하이퍼바이저. (예: VirtualBox, VMware Workstation)
- **VMCS (Virtual Machine Control Structure):** 인텔 VT-x 기반 가상화에서 여러 가상머신의 상태를 저장하고 컨텍스트 스위칭 시 정보를 저장하는 메모리 구조.
- **VM Entries:** 하이퍼바이저의 루트 모드에서 가상머신의 비루트 모드로 제어권이 전환되는 과정.
- **VM Exit:** 가상머신의 비루트 모드에서 하이퍼바이저의 루트 모드로 제어권이 전환되는 과정.
- **전가상화 (Full Virtualization):** 게스트 운영체제의 수정 없이 가상 환경에서 실행되도록 하는 가상화 방식. 게스트 OS는 자신이 가상화 환경에 있는지 인지하지 못함.
- **반가상화 (Paravirtualization):** 게스트 운영체제를 수정하여 하이퍼바이저와 직접 통신할 수 있는 API (하이퍼콜)를 추가함으로써 성능을 최적화하는 가상화 방식. 게스트 OS는 가상화 환경을 인지함.
- **바이너리 트랜슬레이션 (Binary Translation):** 소프트웨어 기반 전가상화에서 게스트 OS의 특권 명령을 하이퍼바이저가 CPU가 인식할 수 있는 새로운 명령으로 변환하는 기술.
- **트랩 (Trap):** 사용자 프로그램에서 시스템 콜과 같은 특권 명령을 실행할 때 발생하는 소프트웨어적인 이벤트로, 커널 모드로의 전환을 유발.
- **인터럽트 (Interrupt):** 하드웨어 장치(예: USB, NIC)에서 비동기적으로 발생하는 이벤트로, CPU의 현재 작업을 중단하고 특정 루틴을 실행하게 함.
- **익셉션 (Exception):** CPU 내부에서 발생하는 오류(예: 0으로 나누기) 또는 예상치 못한 이벤트로, 폴트(복구 가능)와 어보트(복구 불가능)로 나뉨.
- **하이퍼콜 (Hypercall):** 반가상화 환경에서 게스트 운영체제가 하이퍼바이저에게 직접 서비스를 요청하기 위해 사용하는 API.
- **하이브리드 가상화 (Hybrid Virtualization):** 하드웨어 지원 가상화를 기본으로 사용하면서, 특정 성능 제약(I/O, 메모리 집약형 작업)이 있는 경우 반가상화 기술을 조합하여 성능을 개선하는 방식.
- **운영체제 레벨 가상화 (OS Level Virtualization / Containerization):** 하이퍼바이저 없이 호스트 운영체제의 커널을 공유하여 여러 독립적인 사용자 공간(컨테이너)을 생성하고 관리하는 가상화 방식. (예: Docker)
- **VT-x (Intel Virtualization Technology):** 인텔 CPU가 제공하는 하드웨어 기반 가상화 지원 기술.
- **AMD-V (AMD Virtualization):** AMD CPU가 제공하는 하드웨어 기반 가상화 지원 기술.
- **Dom 0 (특권 도메인):** Xen 하이퍼바이저에서 물리 시스템의 장치에 접근 가능한 특권 레벨의 가상머신.
- **Dom U (게스트 도메인):** Xen 하이퍼바이저에서 일반적인 게스트 가상머신.